#include <string.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
#include <time.h>

unsigned char art_txt[] = {
  0x20, 0x20, 0x20, 0x2b, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d,
  0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2b, 0x0a, 0x20, 0x20, 0x20, 0x7c,
  0x2e, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d,
  0x2d, 0x2e, 0x7c, 0x0a, 0x20, 0x20, 0x20, 0x7c, 0x7c, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x7c, 0x7c, 0x0a,
  0x20, 0x20, 0x20, 0x7c, 0x7c, 0x20, 0x20, 0x31, 0x33, 0x33, 0x37, 0x2e,
  0x4d, 0x41, 0x20, 0x20, 0x20, 0x7c, 0x7c, 0x0a, 0x20, 0x20, 0x20, 0x7c,
  0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x7c, 0x7c, 0x0a, 0x20, 0x20, 0x20, 0x7c, 0x7c, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x7c, 0x7c, 0x0a,
  0x20, 0x20, 0x20, 0x7c, 0x2b, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d,
  0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2b, 0x7c, 0x0a, 0x20, 0x20, 0x20, 0x2b,
  0x2d, 0x2e, 0x2e, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2e,
  0x2e, 0x2d, 0x2b, 0x0a, 0x20, 0x20, 0x20, 0x2e, 0x2d, 0x2d, 0x2d, 0x2d,
  0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2e, 0x0a,
  0x20, 0x20, 0x2f, 0x20, 0x2f, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d,
  0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x5c, 0x20, 0x5c, 0x0a, 0x20, 0x2f, 0x20,
  0x2f, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d, 0x3d,
  0x3d, 0x3d, 0x3d, 0x5c, 0x20, 0x5c, 0x0a, 0x2f, 0x5f, 0x5f, 0x5f, 0x5f,
  0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f,
  0x5f, 0x5f, 0x5f, 0x5f, 0x5c, 0x0a, 0x5c, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f,
  0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f,
  0x5f, 0x5f, 0x5f, 0x2f, 0x0a
};

char *rand_string(char *str, size_t size)
{
    const char charset[] = "abcdefghijklmnopqrstuvwxyz";
    if (size) {
        --size;
        for (size_t n = 0; n < size; n++) {
            int key = rand() % (int) (sizeof charset - 1);
            str[n] = charset[key];
        }
        str[size] = '\0';
    }
    return str;
}

int main(int argc, char *argv[]) {
	char	*serial_key;
	char	*input;
	int		flag = 0;
	time_t	time_stuff;
	unsigned int art_txt_len = 269;

	write(1, art_txt, art_txt_len);
	if (argc == 2) {
		srand((unsigned) time(&time_stuff));
		input = argv[1];
		serial_key = rand_string((char *)malloc(16), 16);
		//printf("\n%s\n", serial_key);
		if (strlen(input) == 16) {
			if (!strcmp(serial_key, argv[1])) {
				write(1, "\nAccess authorized!\n", 21);
				flag = 1;
			}
		}
		if (!flag)
			write(1, "\nAccess denied!\n", 17);
	} else
		write(1, "\nProvide a key!\n", 17);
}
